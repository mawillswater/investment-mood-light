<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTCæŠ•èµ„æƒ…ç»ªç¯</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.5s ease;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: none;
            box-shadow: none;
            padding: 0;
        }
        .main-content {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .side-content {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        .info-section {
            margin: 0;
            padding: 0;
            background: none;
            border: none;
        }
        .info-section ul {
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        #message, #quote, #price, #change {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
        }
        #quote {
            font-style: italic;
        }
        #price {
            font-weight: bold;
            font-size: 1.2em;
        }
        #change {
            font-weight: bold;
        }
        .auto-refresh {
            font-size: 0.8em;
            color: #666;
            margin-top: 20px;
        }
        .log-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
        .log-time {
            color: #666;
            margin-right: 10px;
        }
        .new-data {
            color: #4CAF50;
        }
        .cached-data {
            color: #2196F3;
        }
        .mood-light {
            width: 120px;
            height: 120px;
            margin: 10px auto;
            position: relative;
        }
        
        .bulb {
            fill: currentColor;
            stroke: #333;
            stroke-width: 2;
            transition: all 0.5s ease;
        }

        .bulb-inner {
            fill: currentColor;
            stroke: none;
            opacity: 0.8;
        }
        
        .glow-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            animation: breathe 2.5s ease-in-out infinite;
        }
        
        @keyframes breathe {
            0%, 100% {
                filter: drop-shadow(0 0 3px currentColor) brightness(0.9);
            }
            50% {
                filter: drop-shadow(0 0 20px currentColor) brightness(1.2);
            }
        }
        
        .light-container {
            text-align: center;
            margin: 10px 0;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .core-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            align-items: start;
            margin: 10px 0;
        }

        .price-info {
            text-align: left;
            padding: 10px;
        }

        .message-info {
            text-align: left;
            padding: 10px;
        }

        .collapsible {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            margin: 5px 0;
        }

        .collapsible-content {
            display: none;
            padding: 10px;
        }

        .collapsible-content.show {
            display: block;
        }

        .mood-label {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
        
        .mood-color {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .side-content {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <h1>BTCæŠ•èµ„æƒ…ç»ªç¯</h1>
            
            <div class="light-container">
                <div style="position: relative;">
                    <svg class="mood-light" viewBox="0 0 100 100">
                        <!-- ç¯æ³¡è½®å»“ -->
                        <path class="bulb" d="M50 10
                                            C30 10 20 25 20 40
                                            C20 55 35 65 40 70
                                            L40 80 L60 80 L60 70
                                            C65 65 80 55 80 40
                                            C80 25 70 10 50 10Z"/>
                        
                        <!-- å‘å…‰å†…å±‚ -->
                        <path class="bulb-inner" d="M50 12
                                                   C32 12 22 26 22 40
                                                   C22 54 36 63 41 68
                                                   L41 78 L59 78 L59 68
                                                   C64 63 78 54 78 40
                                                   C78 26 68 12 50 12Z"/>
                        
                        <!-- ç¯åº§ -->
                        <path fill="#666" d="M40 80 L60 80 L58 85 L42 85 Z"/>
                        <path fill="#888" d="M42 85 L58 85 L56 90 L44 90 Z"/>
                    </svg>
                    <!-- æ·»åŠ å‘å…‰æ•ˆæœå±‚ -->
                    <svg class="glow-effect" viewBox="0 0 100 100">
                        <path class="bulb" d="M50 10
                                            C30 10 20 25 20 40
                                            C20 55 35 65 40 70
                                            L40 80 L60 80 L60 70
                                            C65 65 80 55 80 40
                                            C80 25 70 10 50 10Z"
                              style="fill: none; stroke: currentColor; stroke-width: 4; opacity: 0.5;"/>
                    </svg>
                </div>
                <div class="mood-label">
                    <span id="mood-text">ç­‰å¾…æ•°æ®...</span>
                    <div class="mood-color" id="mood-color"></div>
                </div>
            </div>

            <div class="core-info">
                <div class="price-info">
                    <div id="price"></div>
                    <div id="change"></div>
                </div>
                <div class="message-info">
                    <div id="message"></div>
                    <div id="quote"></div>
                </div>
            </div>

            <button onclick="updateMood(true)">åˆ·æ–°æ•°æ®</button>
            <div class="auto-refresh">æ•°æ®æ¯2åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ | ä¸Šæ¬¡æ›´æ–°: <span id="last-update">-</span></div>

            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleSection('log')">
                    ğŸ“Š æŸ¥çœ‹APIè°ƒç”¨æ—¥å¿—
                </div>
                <div id="log-section" class="collapsible-content log-section">
                    <div id="api-log"></div>
                </div>
            </div>
        </div>

        <div class="side-content">
            <h2>ğŸ” è¿ä½œæœºåˆ¶è¯´æ˜</h2>
            <div class="info-section">
                <ul>
                    <li><strong>æ•°æ®æ¥æºï¼š</strong>é€šè¿‡ CoinGecko API å®æ—¶è·å–æ¯”ç‰¹å¸ä»·æ ¼å’Œ24å°æ—¶æ¶¨è·Œå¹…</li>
                    <li><strong>æ›´æ–°é¢‘ç‡ï¼š</strong>æ¯2åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡æ•°æ®</li>
                    <li><strong>é¢œè‰²æç¤ºï¼š</strong>
                        <ul>
                            <li>ğŸ”´ çº¢è‰² (æ¶¨å¹… â‰¥ 5%): å¸‚åœºè¿‡çƒ­è­¦å‘Š</li>
                            <li>ğŸŸ  æµ…çº¢è‰² (æ¶¨å¹… â‰¥ 2%): è°¨æ…æç¤º</li>
                            <li>ğŸ”µ æ·¡è“è‰² (-2% < æ³¢åŠ¨ < 2%): å¸‚åœºå¹³ç¨³</li>
                            <li>ğŸŸ¢ æµ…ç»¿è‰² (è·Œå¹… â‰¥ 2%): å…³æ³¨æœºä¼š</li>
                            <li>ğŸŸ¢ ç»¿è‰² (è·Œå¹… â‰¥ 5%): å¯èƒ½å­˜åœ¨æœºä¼š</li>
                        </ul>
                    </li>
                    <li><strong>æƒ…ç»ªå»ºè®®ï¼š</strong>æ ¹æ®æ¶¨è·Œå¹…åº¦è‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„æŠ•èµ„å»ºè®®</li>
                    <li><strong>æŠ•èµ„åè¨€ï¼š</strong>éšæœºæ˜¾ç¤ºæŠ•èµ„å¤§å¸ˆåè¨€ï¼Œæä¾›é•¿æœŸæŠ•èµ„è§†è§’</li>
                </ul>
                <p><strong>ä½¿ç”¨å»ºè®®ï¼š</strong>æ­¤å·¥å…·æ—¨åœ¨å¸®åŠ©æŠ•èµ„è€…ä¿æŒç†æ€§ï¼Œé¿å…æƒ…ç»ªåŒ–äº¤æ˜“ã€‚è¯·ç»“åˆå…¶ä»–åˆ†æå·¥å…·åšå‡ºæŠ•èµ„å†³ç­–ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        function addLogEntry(data, isNewData) {
            const logDiv = document.getElementById('api-log');
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${isNewData ? 'new-data' : 'cached-data'}`;
            
            const logContent = `
                <span class="log-time">[${timeStr}]</span>
                <span>${isNewData ? 'æ–°æ•°æ®' : 'ç¼“å­˜æ•°æ®'}</span><br>
                <small>${JSON.stringify(data, null, 2)}</small>
            `;
            
            logEntry.innerHTML = logContent;
            
            // åœ¨é¡¶éƒ¨æ’å…¥æ–°æ—¥å¿—
            logDiv.insertBefore(logEntry, logDiv.firstChild);
            
            // ä¿æŒæœ€å¤šæ˜¾ç¤º10æ¡è®°å½•
            while (logDiv.children.length > 10) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }

        function updateMood(forceRefresh = false) {
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleTimeString();
            
            const url = forceRefresh ? '/get_btc_mood?force=1' : '/get_btc_mood';
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('message').textContent = data.message;
                    } else {
                        document.body.style.backgroundColor = data.color;
                        // æ›´æ–°æ‰€æœ‰ç›¸å…³å…ƒç´ çš„é¢œè‰²
                        document.querySelector('.bulb').style.color = data.color;
                        document.querySelector('.bulb-inner').style.color = data.color;
                        document.querySelector('.glow-effect').style.color = data.color;
                        
                        // æ›´æ–°æƒ…ç»ªæ–‡æœ¬å’Œé¢œè‰²è¯´æ˜
                        let moodText = '';
                        let colorName = '';
                        const change = parseFloat(data.change.split(':')[1]);
                        
                        if (change >= 5) {
                            moodText = 'å¸‚åœºè¿‡çƒ­';
                            colorName = 'çº¢è‰²è­¦ç¤º';
                        } else if (change >= 2) {
                            moodText = 'åçƒ­';
                            colorName = 'æµ…çº¢è‰²æé†’';
                        } else if (change <= -5) {
                            moodText = 'æåº¦ææ…Œ';
                            colorName = 'æ·±ç»¿è‰²æœºä¼š';
                        } else if (change <= -2) {
                            moodText = 'ææ…Œ';
                            colorName = 'æµ…ç»¿è‰²å…³æ³¨';
                        } else {
                            moodText = 'å¹³ç¨³';
                            colorName = 'æ·¡è“è‰²å®‰å…¨';
                        }
                        
                        document.getElementById('mood-text').textContent = moodText;
                        document.getElementById('mood-color').textContent = colorName;
                        document.getElementById('mood-text').style.color = data.color;
                        
                        // å…¶ä»–æ›´æ–°ä¿æŒä¸å˜
                        document.getElementById('message').textContent = data.message;
                        document.getElementById('quote').textContent = data.quote;
                        document.getElementById('price').textContent = data.price;
                        document.getElementById('change').textContent = data.change;
                        
                        addLogEntry(data, data.cache_info === 'æ–°æ•°æ®');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('message').textContent = 'è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•';
                    addLogEntry({error: error.toString()}, true);
                });
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        updateMood();

        // ç¡®ä¿ä¹‹å‰çš„å®šæ—¶å™¨è¢«æ¸…é™¤
        if (window.moodTimer) {
            clearInterval(window.moodTimer);
        }

        // è®¾ç½®æ–°çš„å®šæ—¶å™¨å¹¶ä¿å­˜å¼•ç”¨ï¼ˆ120000ms = 2åˆ†é’Ÿï¼‰
        window.moodTimer = setInterval(() => updateMood(), 120000);

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-section`);
            content.classList.toggle('show');
        }
    </script>
</body>
</html> 